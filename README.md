# JSON Schema to AWS Glue schema converter

## Installation

```bash
pip install git+https://github.com/sneako/j2g.git

```

## What?

Converts `json schema` to `AWS glue schema`.

## Why?

When using `AWS Kinesis Firehose` in a configuration that receives JSONs and writes `parquet` files on S3, one needs to define a `AWS Glue` table so Firehose knows what schema to use when creating the parquet files.

AWS Glue let's you define a schema using `Avro` or `JSON Schema` and then to create a table from that schema, but as of *May 2022` there's a limitations on AWS that tables that are created that way can't be used with Kinesis Firehose.

https://stackoverflow.com/questions/68125501/invalid-schema-error-in-aws-glue-created-via-terraform

This is also confirmed by AWS support.

What one could do is create a table set the columns manually, but this means you now have two sources of truth to maintain.

This tool allows you to define a table in `pydantic` and generate a JSON with column types that can be used with `terraform` to create a Glue table.

## Example

Take the following pydantic class

```json
{
  "title": "Foo",
  "type": "object",
  "properties": {
    "nums": {
      "title": "Nums",
      "type": "array",
      "items": {
        "type": "integer"
      }
    },
    "bars": {
      "title": "Bars",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Bar"
      }
    },
    "other": {
      "title": "Other",
      "type": "string"
    }
  },
  "required": [
    "nums",
    "bars",
    "other"
  ],
  "definitions": {
    "Bar": {
      "title": "Bar",
      "type": "object",
      "properties": {
        "name": {
          "title": "Name",
          "type": "string"
        },
        "age": {
          "title": "Age",
          "type": "integer"
        }
      },
      "required": [
        "name",
        "age"
      ]
    }
  }
}
```

Running `j2g`
```bash
j2g example.json
```

you get this JSON

```json
{
  "//": "Generated by j2g at 2022-05-25 12:35:55.333570. DO NOT EDIT",
  "columns": {
    "nums": "array<int>",
    "bars": "array<struct<name:string,age:int>>",
    "other": "string"
  }
}
```

